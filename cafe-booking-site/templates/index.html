{% extends "base.html" %}

{% block content %}
<div class="main-layout">
    
    <div class="content-area">
        <h1 style="font-size: 2rem; margin-bottom: 20px;">Лучшие рестораны города</h1>
        
        <div class="cafe-grid">
            {% for cafe in cafes %}
            <div class="cafe-card">
                <!-- ВАЖНО: Убедитесь, что расширение картинок совпадает (png или jpg) -->
                <div class="cafe-image" style="background-image: url('{{ url_for('static', filename='images/' ~ cafe.id ~ '.png') }}');">
                    <!-- Хедер карточки поверх фото -->
                    <div class="card-overlay-top">
                        <div class="rating-badge">
                            <i class="fas fa-star"></i> {{ "%.1f"|format(cafe.avg_rating if cafe.avg_rating else 5.0) }}
                        </div>
                        <button class="favorite-btn"><i class="far fa-heart"></i></button>
                    </div>
                </div>

                <div class="cafe-info">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <h3>{{ cafe.name }}</h3>

                        <!-- ЛОГИКА ЦЕН (Диапазоны) -->
                        <div class="price-range-badge">
                            {% if cafe.avg_check > 3000 %}
                                3000 - 5000+ ₽
                            {% elif cafe.avg_check > 1500 %}
                                1500 - 3000 ₽
                            {% else %}
                                500 - 1500 ₽
                            {% endif %}
                        </div>
                    </div>
                    
                    <p class="address"><i class="fas fa-map-marker-alt"></i> {{ cafe.address }}</p>
                    
                    <!-- Теги -->
                    <div class="tags-container">
                        {% for tag in cafe.tags.split(',') %}
                            <span class="mini-tag">{{ tag }}</span>
                        {% endfor %}
                    </div>
                    
                    <div style="margin-top: 10px; font-size: 0.8rem; color: #888;">
                        <i class="fas fa-comment-alt"></i> {{ cafe.review_count }} отзывов
                    </div>

                    <a href="{{ url_for('booking', cafe=cafe.id) }}" class="btn btn-full">Открыть карту зала</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- ФИЛЬТРЫ -->
    <aside class="filters-sidebar">
        <h3><i class="fas fa-sliders-h"></i> Фильтры</h3>
        <form action="{{ url_for('index') }}" method="GET">
            <div class="filter-group">
                <label>Кухня:</label>
                <select name="cuisine">
                    <option value="all">Все кухни</option>
                    {% for c in cuisines %}
                    <option value="{{ c.cuisine }}">{{ c.cuisine }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="filter-group">
                <label>Средний чек:</label>
                <div style="display:flex; gap:10px;">
                    <button type="button" class="btn-outline btn-sm">₽</button>
                    <button type="button" class="btn-outline btn-sm">₽₽</button>
                    <button type="button" class="btn-outline btn-sm">₽₽₽</button>
                </div>
            </div>

            <button type="submit" class="btn btn-full">Применить</button>
        </form>
    </aside>

</div>
{% endblock %}
